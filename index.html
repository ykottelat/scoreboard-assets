<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HTML5 Scoreboard</title>

  <!-- Droid Sans Mono -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Droid+Sans+Mono&display=swap" rel="stylesheet">

  <style>
    :root{
      /* Colors */
      --bg:#0b0b0b; --fg:#f5f5f5; --muted:#bdbdbd; --accent:#e53935;
      --digit-shadow:0 0 12px rgba(255,255,255,.15);

      /* Fallback absolute sizes (1024×576 reference) */
      --clock-w:460px; --clock-h:200px;
      --logo-w:220px;  --logo-h:272px;
    }

    /* Global */
    *,*::before,*::after{ box-sizing:border-box; }
    html,body{ width:100%; max-width:100%; overflow-x:hidden; height:100%; }
    body{
      margin:0;
      font-family:'Droid Sans Mono', ui-monospace, SFMono-Regular, Menlo, Consolas, 'Liberation Mono', 'Courier New', monospace;
      background:var(--bg); color:var(--fg);
      display:grid; place-items:center;
    }

    /* Board container */
    .board{
      width:min(100dvw, 1024px, calc(100dvh * (16/9)));
      aspect-ratio:16/9; height:auto;
      position:relative; overflow:hidden;
      padding:clamp(8px,2vw,24px);
      display:grid; grid-template-rows:auto 1fr auto;
      border-radius:24px;
      box-shadow:0 20px 60px rgba(0,0,0,.45) inset, 0 10px 30px rgba(0,0,0,.35);
      background:rgba(13,71,161,.92);
      container-type:size;               /* enable cqw/cqh */
    }

    .top{ display:grid; grid-template-columns:1fr auto 1fr; align-items:center; gap:clamp(8px,2vw,24px); }

    /* === CLOCK: fixed-size box, centered horizontally === */
    .game-clock{
      position:absolute; top:0; left:50%; transform:translateX(-50%);
      width:var(--clock-w); height:var(--clock-h);
      display:grid; place-items:center;
      font-variant-numeric:tabular-nums; letter-spacing:.04em; text-shadow:var(--digit-shadow);
      font-weight:700; line-height:1;
      /* Auto-fit text inside 460×200 box */
      font-size: min(calc(var(--clock-w) / 5.2), calc(var(--clock-h) * 0.8));
      border-radius:16px; border:2px solid transparent;
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
      z-index:10;
    }

    /* === LOGOS: centered in the spaces left/right of the clock === */
    .logo{
      position:absolute; top:0;
      width:var(--logo-w); height:var(--logo-h);
      object-fit:contain; filter:drop-shadow(0 4px 8px rgba(0,0,0,.5));
    }
    /* Left region center = 25% of board width minus clock_w/4; place logo centered there */
    .logo.home{
      left: calc(25% - (var(--clock-w) / 4) - (var(--logo-w) / 2));
    }
    /* Right region center = 75% of board width plus clock_w/4; place logo centered there */
    .logo.away{
      left: calc(75% + (var(--clock-w) / 4) - (var(--logo-w) / 2));
    }

    /* Middle row: scores + sponsor */
    .middle{ display:grid; grid-template-columns:1fr auto 1fr; align-items:center; }
    .score{
      font-variant-numeric:tabular-nums; font-weight:800; text-shadow:var(--digit-shadow);
      font-size:clamp(48px, 14vmin, 200px); line-height:1;
    }
    .score.home{ justify-self:start; } .score.away{ justify-self:end; }

    .sponsor{ opacity:.85; display:grid; place-items:center; }
    .sponsor img{
      width:520px; height:254px; object-fit:contain;
      filter:drop-shadow(0 6px 16px rgba(0,0,0,.6));
    }

    /* Bottom time-of-day */
    .bottom{ display:grid; place-items:center; }
    .tod{ font-variant-numeric:tabular-nums; color:var(--muted); font-size:clamp(18px,5vw,40px); letter-spacing:.12em; text-shadow:0 0 10px rgba(0,0,0,.6); }

    /* Team name labels */
    .labels{
      position:absolute; left:0; right:0; top:50%; transform:translateY(-50%);
      pointer-events:none; display:grid; grid-template-columns:1fr 1fr;
      padding:0 clamp(8px,2vw,24px); font-size:clamp(10px,2.2vw,22px); color:#d3d3d3; opacity:.85;
    }
    .labels div{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .labels .home{ justify-self:start; } .labels .away{ justify-self:end; }

    /* Controls */
    .controls{
      position:absolute; left:50%; transform:translateX(-50%);
      bottom:8px; display:flex; gap:8px; align-items:center;
      background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12);
      padding:6px 10px; border-radius:999px; backdrop-filter:blur(6px);
      font-size:14px; color:#eee;
    }
    .controls button, .controls input[type="number"]{
      background:rgba(0,0,0,.35); border:1px solid rgba(255,255,255,.18);
      color:#fff; padding:6px 10px; border-radius:10px; font-size:14px;
    }
    .controls .spacer{ width:1px; height:20px; background:rgba(255,255,255,.18); margin:0 4px; }
    .clean .controls{ display:none; }

    /* ===== Responsive scaling with container query units ===== */
    @supports (width: 1cqw){
      :root{
        /* Percent of 1024×576 reference */
        --clock-w-p:44.921875;  /* 460/1024 * 100 */
        --clock-h-p:34.722222;  /* 200/576  * 100 */
        --logo-w-p:21.484375;   /* 220/1024 * 100 */
        --logo-h-p:47.222222;   /* 272/576  * 100 */
        --sponsor-w-p:50.78125; /* 520/1024 * 100 */
        --sponsor-h-p:44.097222;/* 254/576  * 100 */
      }

      .game-clock{
        width: calc(var(--clock-w-p) * 1cqw);
        height: calc(var(--clock-h-p) * 1cqh);
        /* Auto-fit inside scalable box */
        font-size: min(
          calc((var(--clock-w-p) * 1cqw) / 5.2),
          calc(var(--clock-h-p) * 1cqh * 0.8)
        );
      }

      .logo{
        width: calc(var(--logo-w-p) * 1cqw);
        height: calc(var(--logo-h-p) * 1cqh);
      }
      /* Left: center between left edge and clock-left */
      .logo.home{
        left: calc(25cqw - (var(--clock-w-p) * 1cqw)/4 - (var(--logo-w-p) * 1cqw)/2);
      }
      /* Right: center between clock-right and right edge */
      .logo.away{
        left: calc(75cqw + (var(--clock-w-p) * 1cqw)/4 - (var(--logo-w-p) * 1cqw)/2);
      }

      .sponsor img{
        width: calc(var(--sponsor-w-p) * 1cqw);
        height: calc(var(--sponsor-h-p) * 1cqh);
      }
    }
  </style>
</head>
<body>
  <div class="board" id="board">
    <div class="top">
      <img id="homeLogo" class="logo home" alt="Home logo" />
      <div class="game-clock" id="gameClock">00:00</div>
      <img id="awayLogo" class="logo away" alt="Away logo" />
    </div>

    <div class="middle">
      <div class="score home" id="homeScore">0</div>
      <div class="sponsor"><img id="sponsorLogo" alt="Sponsor logo" /></div>
      <div class="score away" id="awayScore">0</div>
    </div>

    <div class="labels">
      <div class="home" id="homeName"></div>
      <div class="away" id="awayName"></div>
    </div>

    <div class="bottom">
      <div class="tod" id="timeOfDay">00:00:00</div>
    </div>

    <div class="controls" id="controls">
      <button id="playPause">▶︎ Start</button>
      <button id="reset">↺ Reset</button>
      <span class="spacer"></span>
      <button id="homePlus">Home +</button>
      <button id="homeMinus">Home −</button>
      <button id="awayPlus">Away +</button>
      <button id="awayMinus">Away −</button>
      <span class="spacer"></span>
      <button id="fullBtn">⤢ Fullscreen</button>
    </div>
  </div>

  <script>
    // ===== Utilities
    const qs = (s) => document.querySelector(s);
    const pad2 = (n) => String(n).padStart(2, '0');

    // ===== DOM refs
    const gameClockEl = qs('#gameClock');
    const todEl = qs('#timeOfDay');
    const homeScoreEl = qs('#homeScore');
    const awayScoreEl = qs('#awayScore');

    // ===== Local Game Clock (fallback)
    let local = { running:false, startTime:0, carry:0 };

    // ===== Network Clock (authoritative)
    let net = null; // { running, startEpochMs, carryMs }
    let skewMs = 0;

    const computeDisplayFromClock = (clock) => {
      const nowMs = Date.now() - (net ? skewMs : 0);
      const elapsed = (clock.running ? (nowMs - clock.startEpochMs) : 0) + (clock.carryMs || 0);
      const total = Math.max(0, Math.floor(elapsed / 1000));
      return `${pad2(Math.floor(total/60))}:${pad2(total%60)}`;
    };

    const tickGameClock = () => {
      if (net) {
        gameClockEl.textContent = computeDisplayFromClock({
          running: net.running, startEpochMs: net.startEpochMs, carryMs: net.carryMs
        });
      } else {
        const now = Date.now();
        const elapsed = (local.running ? (now - local.startTime) : 0) + local.carry;
        const total = Math.floor(elapsed / 1000);
        gameClockEl.textContent = `${pad2(Math.floor(total/60))}:${pad2(total%60)}`;
      }
      requestAnimationFrame(tickGameClock);
    };
    requestAnimationFrame(tickGameClock);

    // Time of day
    const tickTOD = () => {
      const now = new Date();
      todEl.textContent = `${pad2(now.getHours())}:${pad2(now.getMinutes())}:${pad2(now.getSeconds())}`;
    };
    tickTOD(); setInterval(tickTOD, 1000);

    // Local-only score bumpers
    const bump = (el, d) => { if (net) return; const v = Math.max(0, (parseInt(el.textContent,10)||0) + d); el.textContent = v; };

    // Buttons
    qs('#playPause').addEventListener('click', () => (local.running ? pauseClock() : startClock()));
    qs('#reset').addEventListener('click', resetClock);
    qs('#homePlus').addEventListener('click', () => bump(homeScoreEl, +1));
    qs('#homeMinus').addEventListener('click', () => bump(homeScoreEl, -1));
    qs('#awayPlus').addEventListener('click', () => bump(awayScoreEl, +1));
    qs('#awayMinus').addEventListener('click', () => bump(awayScoreEl, -1));
    qs('#fullBtn').addEventListener('click', async () => {
      const el = qs('#board');
      if (!document.fullscreenElement) { await el.requestFullscreen().catch(()=>{}); }
      else { await document.exitFullscreen().catch(()=>{}); }
    });

    function startClock(){ if (net || local.running) return; local.running = true; local.startTime = Date.now(); qs('#playPause').textContent='⏸ Pause'; }
    function pauseClock(){ if (net || !local.running) return; local.running = false; local.carry += Date.now() - local.startTime; qs('#playPause').textContent='▶︎ Start'; }
    function resetClock(){ if (net) return; local = { running:false, startTime:0, carry:0 }; gameClockEl.textContent='00:00'; qs('#playPause').textContent='▶︎ Start'; }

    // ===== Query params
    const params = new URLSearchParams(location.search);
    const setImg = (id, url) => { const el = qs(id); if (url){ el.src = url; el.style.visibility='visible'; } else { el.style.visibility='hidden'; } };
    const setText = (id, val) => { if (val != null) qs(id).textContent = val; };
